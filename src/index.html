<!DOCTYPE html>
<html>
  <head>
    <title>WordCatch Server</title>
    <style>
      body { 
        margin: 0; 
        height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      }
    </style>
  </head>
  <body id='main'>
    <h1>WordCatch Server</h1>
    <button id='create-button'>Create Room</button>
    <form id='room-join-form' action="">
      <input id='room-id-input' autocomplete="off"/><button>Done</button>
    </form>
    <button id='select-word-range-button'>Select Word Range</button>
    <button id='select-words-button'>Select Words to guess</button>
    <button id='send-attempt-button'>Send attempt</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io('http://localhost:8080/game-room', { autoConnect: false });

      const CREATE_ACTION_CODE = "create-room";
      const JOIN_ACTION_CODE = "join-to-room";
      let connectAction = CREATE_ACTION_CODE;

      let room = '';

      const wordsSelected = ['test word1', 'test word2', 'test word3'];

      const createRoomButton = document.getElementById('create-button');
      createRoomButton.onclick = () => {
        console.log("connecting...");
        socket.connect();
      }

      const roomIdInput = document.getElementById('room-id-input');
      const connectToRoomForm = document.getElementById('room-join-form');

      connectToRoomForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const roomId = roomIdInput.value;
        if (roomId) {
          connectAction = JOIN_ACTION_CODE;
          socket.connect();
        } else {
          alert('You must give a roomId!');
        }
      });

      const selectWordRangeButton = document.getElementById('select-word-range-button');
      selectWordRangeButton.onclick = () => {
        socket.emit('word-range-selected', { words: wordsSelected, room });
      }

      const selectWordsButton = document.getElementById('select-words-button');
      selectWordsButton.onclick = () => {
        socket.emit('words-selected', { words: wordsSelected.slice(-2), room });
      }

      const sendAttemptButton = document.getElementById('send-attempt-button');
      sendAttemptButton.onclick = () => {
        socket.emit('send-attempt', { words: wordsSelected.slice(0,2), room });
      }

      socket.on('connected', (socketId) => {
        console.log(`Connected to server. User Id=${socketId}`);
        if (connectAction === 'create-room') room = 'new-room';
        else if (connectAction === 'join-to-room') room = roomIdInput.value;

        socket.emit(connectAction, room);
      });

      socket.on('user-joined', (event) => {
        console.log(`Users connected to room ${event.user}`);
        console.log(`Users in room: ${event.usersInRoom}`);
      });

      socket.on('word-range-selected', (words) => {
        console.log(`Selected word range => ${words}`);
      });

      socket.on('words-selected', (words) => {
        console.log(`Words selected => ${words}`);
      });

      socket.on('attempt-checked', (result) => {
        console.log(`Attempt result: ${JSON.stringify(result.successful)}. 
        Words: ${JSON.stringify(result.words)}. Points: ${JSON.stringify(result.points)}`);
      });

      socket.on('disconnected', (socketId) => {
        if (socketId === socket.id) alert(`User with Id=${socketId} disconnected.`);
        else {
          console.log(`User with Id=${socketId} disconnected.`);
        }
      });

    </script>
  </body>
</html>